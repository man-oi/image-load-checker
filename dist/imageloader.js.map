{"version":3,"sources":["imageloader.js"],"names":["Imageloader","window","options","_","defaults","imageSelector","timeoutTime","imageLoaded","element","classList","add","imageLoadedAfterTimeout","imageError","imageErrorAfterTimeout","imageTimeout","imageElements","timeoutFunctions","timeouts","loadedImages","errorImages","timeoutImages","init","console","log","undefined","extend","document","querySelectorAll","bindEvents","event","createEvent","i","length","addEventListener","loaded","error","setTimeout","timeout","complete","naturalWidth","initEvent","dispatchEvent","e","target","src","key","Array","prototype","slice","call","indexOf","clearTimeout","removeEventListener","allLoaded","notAllLoaded","allFails","destination","property"],"mappings":";;AAAA,IAAIA,WAAW,GAAGC,MAAM,CAACD,WAAP,IAAsB,EAAxC;;AAEAA,WAAW,GAAI,YAAW;AACtB;;AAEA,WAASA,WAAT,CAAqBE,OAArB,EAA8B;AAC1B,QAAIC,CAAC,GAAI,EAAT;AACAA,IAAAA,CAAC,CAACC,QAAF,GAAa;AACTC,MAAAA,aAAa,EAAE,KADN;AAETC,MAAAA,WAAW,EAAE,OAAO,EAFX;AAGTC,MAAAA,WAAW,EAAE,qBAASC,OAAT,EAAkB;AAC3BA,QAAAA,OAAO,CAACC,SAAR,CAAkBC,GAAlB,CAAsB,QAAtB;AACH,OALQ;AAMTC,MAAAA,uBAAuB,EAAE,iCAASH,OAAT,EAAkB;AACvCA,QAAAA,OAAO,CAACC,SAAR,CAAkBC,GAAlB,CAAsB,QAAtB;AACH,OARQ;AASTE,MAAAA,UAAU,EAAE,oBAASJ,OAAT,EAAkB;AAC1BA,QAAAA,OAAO,CAACC,SAAR,CAAkBC,GAAlB,CAAsB,OAAtB;AACH,OAXQ;AAYTG,MAAAA,sBAAsB,EAAE,gCAASL,OAAT,EAAkB;AACtCA,QAAAA,OAAO,CAACC,SAAR,CAAkBC,GAAlB,CAAsB,OAAtB;AACH,OAdQ;AAeTI,MAAAA,YAAY,EAAE,sBAASN,OAAT,EAAkB,CAAE;AAfzB,KAAb;AAiBAL,IAAAA,CAAC,CAACD,OAAF,GAAY,EAAZ;AACAC,IAAAA,CAAC,CAACY,aAAF,GAAkB,IAAlB;AACAZ,IAAAA,CAAC,CAACa,gBAAF,GAAqB,EAArB;AACAb,IAAAA,CAAC,CAACc,QAAF,GAAa,EAAb;AACAd,IAAAA,CAAC,CAACe,YAAF,GAAiB,CAAjB;AACAf,IAAAA,CAAC,CAACgB,WAAF,GAAgB,CAAhB;AACAhB,IAAAA,CAAC,CAACiB,aAAF,GAAkB,CAAlB;;AAGAjB,IAAAA,CAAC,CAACkB,IAAF,GAAS,YAAW;AAChBC,MAAAA,OAAO,CAACC,GAAR,CAAY,MAAZ;;AACA,UAAIrB,OAAO,KAAKsB,SAAhB,EAA2B;AACvBtB,QAAAA,OAAO,GAAG,EAAV;AACH;;AACDC,MAAAA,CAAC,CAACsB,MAAF,CAAStB,CAAC,CAACD,OAAX,EAAoBC,CAAC,CAACC,QAAtB,EAAgCF,OAAhC;;AAEAC,MAAAA,CAAC,CAACY,aAAF,GAAkBW,QAAQ,CAACC,gBAAT,CAA0BxB,CAAC,CAACD,OAAF,CAAUG,aAApC,CAAlB;;AAEAF,MAAAA,CAAC,CAACyB,UAAF;AACH,KAVD;;AAYAzB,IAAAA,CAAC,CAACyB,UAAF,GAAe,YAAW;AACtB,UAAIC,KAAK,GAAGH,QAAQ,CAACI,WAAT,CAAqB,YAArB,CAAZ;;AAEA,WAAK,IAAIC,CAAC,GAAG,CAAb,EAAgBA,CAAC,GAAG5B,CAAC,CAACY,aAAF,CAAgBiB,MAApC,EAA4CD,CAAC,EAA7C,EAAiD;AAC7C5B,QAAAA,CAAC,CAACY,aAAF,CAAgBgB,CAAhB,EAAmBE,gBAAnB,CAAoC,MAApC,EAA4C9B,CAAC,CAAC+B,MAA9C;;AACA/B,QAAAA,CAAC,CAACY,aAAF,CAAgBgB,CAAhB,EAAmBE,gBAAnB,CAAoC,OAApC,EAA6C9B,CAAC,CAACgC,KAA/C;;AAEAhC,QAAAA,CAAC,CAACa,gBAAF,CAAmBe,CAAnB,IAAwB9B,MAAM,CAACmC,UAAP,CAAkB,UAASL,CAAT,EAAY;AAClD5B,UAAAA,CAAC,CAACkC,OAAF,CAAUlC,CAAC,CAACY,aAAF,CAAgBgB,CAAhB,CAAV;AACH,SAFuB,EAErB5B,CAAC,CAACD,OAAF,CAAUI,WAFW,EAEEyB,CAFF,CAAxB;AAGA5B,QAAAA,CAAC,CAACc,QAAF,CAAWc,CAAX,IAAgB,KAAhB;;AAGA,YAAI5B,CAAC,CAACY,aAAF,CAAgBgB,CAAhB,EAAmBO,QAAvB,EAAiC;AAC7B,cAAInC,CAAC,CAACY,aAAF,CAAgBgB,CAAhB,EAAmBQ,YAAnB,KAAqC,CAAzC,EAA4C;AACxCV,YAAAA,KAAK,CAACW,SAAN,CAAgB,OAAhB,EAAyB,IAAzB,EAA+B,IAA/B;AACH,WAFD,MAGK;AACDX,YAAAA,KAAK,CAACW,SAAN,CAAgB,MAAhB,EAAwB,IAAxB,EAA8B,IAA9B;AACH;;AAEDrC,UAAAA,CAAC,CAACY,aAAF,CAAgBgB,CAAhB,EAAmBU,aAAnB,CAAiCZ,KAAjC;AACH;AACJ;AACJ,KAxBD;AA4BA;;;;;AAGA1B,IAAAA,CAAC,CAAC+B,MAAF,GAAW,UAASQ,CAAT,EAAY;AACnBpB,MAAAA,OAAO,CAACC,GAAR,CAAY,aAAamB,CAAC,CAACC,MAAF,CAASC,GAAlC;AACA,UAAIpC,OAAO,GAAGkC,CAAC,CAACC,MAAhB;AACA,UAAIE,GAAG,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2B9C,CAAC,CAACY,aAA7B,EAA4CmC,OAA5C,CAAoD1C,OAApD,CAAV;AAEAP,MAAAA,MAAM,CAACkD,YAAP,CAAoBhD,CAAC,CAACa,gBAAF,CAAmB6B,GAAnB,CAApB;AACArC,MAAAA,OAAO,CAAC4C,mBAAR,CAA4B,MAA5B,EAAoCjD,CAAC,CAAC+B,MAAtC;;AAEA,UAAI,CAAC/B,CAAC,CAACc,QAAF,CAAW4B,GAAX,CAAL,EAAsB;AAClB1C,QAAAA,CAAC,CAACe,YAAF;;AACAf,QAAAA,CAAC,CAACD,OAAF,CAAUK,WAAV,CAAsBC,OAAtB;;AAEA,YAAIL,CAAC,CAACe,YAAF,GAAiBf,CAAC,CAACgB,WAAnB,GAAiChB,CAAC,CAACiB,aAAnC,KAAqDjB,CAAC,CAACY,aAAF,CAAgBiB,MAAzE,EAAiF;AAC7E,cAAI7B,CAAC,CAACe,YAAF,KAAmBf,CAAC,CAACY,aAAF,CAAgBiB,MAAvC,EAA+C;AAC3C7B,YAAAA,CAAC,CAACkD,SAAF;AACH,WAFD,MAGK;AACDlD,YAAAA,CAAC,CAACmD,YAAF;AACH;AACJ;AACJ,OAZD,MAaK;AACDnD,QAAAA,CAAC,CAACD,OAAF,CAAUS,uBAAV,CAAkCH,OAAlC;AACH;AACJ,KAxBD,EA0BAL,CAAC,CAACgC,KAAF,GAAU,UAASO,CAAT,EAAY;AAClB,UAAIlC,OAAO,GAAGkC,CAAC,CAACC,MAAhB;AACA,UAAIE,GAAG,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2B9C,CAAC,CAACY,aAA7B,EAA4CmC,OAA5C,CAAoD1C,OAApD,CAAV;AAEAP,MAAAA,MAAM,CAACkD,YAAP,CAAoBhD,CAAC,CAACa,gBAAF,CAAmB6B,GAAnB,CAApB;AACArC,MAAAA,OAAO,CAAC4C,mBAAR,CAA4B,OAA5B,EAAqCjD,CAAC,CAACgC,KAAvC;;AAEA,UAAI,CAAChC,CAAC,CAACc,QAAF,CAAW4B,GAAX,CAAL,EAAsB;AAClB1C,QAAAA,CAAC,CAACgB,WAAF;;AACAhB,QAAAA,CAAC,CAACD,OAAF,CAAUU,UAAV,CAAqBJ,OAArB;;AAEA,YAAIL,CAAC,CAACe,YAAF,GAAiBf,CAAC,CAACgB,WAAnB,GAAiChB,CAAC,CAACiB,aAAnC,KAAqDjB,CAAC,CAACY,aAAF,CAAgBiB,MAAzE,EAAiF;AAC7E,cAAI7B,CAAC,CAACgB,WAAF,KAAkBhB,CAAC,CAACY,aAAF,CAAgBiB,MAAtC,EAA8C;AAC1C7B,YAAAA,CAAC,CAACoD,QAAF;AACH,WAFD,MAGK;AACDpD,YAAAA,CAAC,CAACmD,YAAF;AACH;AACJ;AACJ,OAZD,MAaK;AACDnD,QAAAA,CAAC,CAACD,OAAF,CAAUW,sBAAV,CAAiCL,OAAjC;AACH;AACJ,KAjDD;;AAmDAL,IAAAA,CAAC,CAACkC,OAAF,GAAY,UAAS7B,OAAT,EAAkB;AAC1B,UAAIqC,GAAG,GAAGC,KAAK,CAACC,SAAN,CAAgBC,KAAhB,CAAsBC,IAAtB,CAA2B9C,CAAC,CAACY,aAA7B,EAA4CmC,OAA5C,CAAoD1C,OAApD,CAAV;AAEAL,MAAAA,CAAC,CAACc,QAAF,CAAW4B,GAAX,IAAkB,IAAlB;AACA1C,MAAAA,CAAC,CAACiB,aAAF;;AAEAjB,MAAAA,CAAC,CAACD,OAAF,CAAUY,YAAV,CAAuBN,OAAvB;;AAEA,UAAIL,CAAC,CAACe,YAAF,GAAiBf,CAAC,CAACgB,WAAnB,GAAiChB,CAAC,CAACiB,aAAnC,KAAqDjB,CAAC,CAACY,aAAF,CAAgBiB,MAAzE,EAAiF;AAC7E,YAAI7B,CAAC,CAACgB,WAAF,KAAkBhB,CAAC,CAACY,aAAF,CAAgBiB,MAAtC,EAA8C;AAC1C7B,UAAAA,CAAC,CAACoD,QAAF;AACH,SAFD,MAGK;AACDpD,UAAAA,CAAC,CAACmD,YAAF;AACH;AACJ;AACJ,KAhBD;AAoBA;;;;;AAGAnD,IAAAA,CAAC,CAACoD,QAAF,GAAa,YAAW;AACpBjC,MAAAA,OAAO,CAACC,GAAR,CAAY,WAAZ;AACH,KAFD,EAIApB,CAAC,CAACkD,SAAF,GAAc,YAAW;AACrB/B,MAAAA,OAAO,CAACC,GAAR,CAAY,YAAZ;AACH,KAND,EAQApB,CAAC,CAACmD,YAAF,GAAiB,YAAW;AACxBhC,MAAAA,OAAO,CAACC,GAAR,CAAY,0BAA0BpB,CAAC,CAACe,YAA5B,GAA2C,MAA3C,GAAoDf,CAAC,CAACY,aAAF,CAAgBiB,MAAhF;AACH,KAVD;AAcA;;;AAGA7B,IAAAA,CAAC,CAACsB,MAAF,GAAW,UAAS+B,WAAT,EAAsBpD,QAAtB,EAAgCF,OAAhC,EAAyC;AAChD,WAAK,IAAIuD,QAAT,IAAqBrD,QAArB,EAA+B;AAC3B,YAAIF,OAAO,CAACuD,QAAD,CAAX,EAAuB;AACnBD,UAAAA,WAAW,CAACC,QAAD,CAAX,GAAwBvD,OAAO,CAACuD,QAAD,CAA/B;AACH,SAFD,MAGK;AACDD,UAAAA,WAAW,CAACC,QAAD,CAAX,GAAwBrD,QAAQ,CAACqD,QAAD,CAAhC;AACH;AACJ;;AACD,aAAOD,WAAP;AACH,KA3BD;;AA6BArD,IAAAA,CAAC,CAACkB,IAAF;AACH;;AAED,SAAOrB,WAAP;AACH,CArLa,EAAd","sourcesContent":["let Imageloader = window.Imageloader || {};\r\n\r\nImageloader = (function() {\r\n    'use strict'\r\n\r\n    function Imageloader(options) {\r\n        var _ =  {};\r\n        _.defaults = {\r\n            imageSelector: 'img',\r\n            timeoutTime: 1000 * 60,\r\n            imageLoaded: function(element) {\r\n                element.classList.add('loaded');\r\n            },\r\n            imageLoadedAfterTimeout: function(element) {\r\n                element.classList.add('loaded');\r\n            },\r\n            imageError: function(element) {\r\n                element.classList.add('error');\r\n            },\r\n            imageErrorAfterTimeout: function(element) {\r\n                element.classList.add('error');\r\n            },\r\n            imageTimeout: function(element) {}\r\n        };\r\n        _.options = {};\r\n        _.imageElements = null;\r\n        _.timeoutFunctions = [];\r\n        _.timeouts = [];\r\n        _.loadedImages = 0;\r\n        _.errorImages = 0;\r\n        _.timeoutImages = 0;\r\n\r\n\r\n        _.init = function() {\r\n            console.log('init');\r\n            if (options === undefined) {\r\n                options = {};\r\n            }\r\n            _.extend(_.options, _.defaults, options);\r\n\r\n            _.imageElements = document.querySelectorAll(_.options.imageSelector);\r\n\r\n            _.bindEvents();\r\n        }\r\n\r\n        _.bindEvents = function() {\r\n            var event = document.createEvent(\"HTMLEvents\");\r\n\r\n            for (var i = 0; i < _.imageElements.length; i++) {\r\n                _.imageElements[i].addEventListener('load', _.loaded);\r\n                _.imageElements[i].addEventListener('error', _.error);\r\n\r\n                _.timeoutFunctions[i] = window.setTimeout(function(i) {\r\n                    _.timeout(_.imageElements[i])\r\n                }, _.options.timeoutTime, i);\r\n                _.timeouts[i] = false;\r\n\r\n\r\n                if (_.imageElements[i].complete) {\r\n                    if (_.imageElements[i].naturalWidth  === 0) {\r\n                        event.initEvent(\"error\", true, true);\r\n                    }\r\n                    else {\r\n                        event.initEvent(\"load\", true, true);\r\n                    }\r\n\r\n                    _.imageElements[i].dispatchEvent(event);\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n\r\n        /*\r\n            Image Events\r\n        */\r\n        _.loaded = function(e) {\r\n            console.log('loaded: ' + e.target.src);\r\n            var element = e.target;\r\n            var key = Array.prototype.slice.call(_.imageElements).indexOf(element);\r\n\r\n            window.clearTimeout(_.timeoutFunctions[key]);\r\n            element.removeEventListener('load', _.loaded);\r\n\r\n            if (!_.timeouts[key]) {\r\n                _.loadedImages++;\r\n                _.options.imageLoaded(element);\r\n\r\n                if (_.loadedImages + _.errorImages + _.timeoutImages === _.imageElements.length) {\r\n                    if (_.loadedImages === _.imageElements.length) {\r\n                        _.allLoaded();\r\n                    }\r\n                    else {\r\n                        _.notAllLoaded();\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                _.options.imageLoadedAfterTimeout(element);\r\n            }\r\n        },\r\n\r\n        _.error = function(e) {\r\n            var element = e.target;\r\n            var key = Array.prototype.slice.call(_.imageElements).indexOf(element);\r\n\r\n            window.clearTimeout(_.timeoutFunctions[key]);\r\n            element.removeEventListener('error', _.error);\r\n\r\n            if (!_.timeouts[key]) {\r\n                _.errorImages++;\r\n                _.options.imageError(element);\r\n\r\n                if (_.loadedImages + _.errorImages + _.timeoutImages === _.imageElements.length) {\r\n                    if (_.errorImages === _.imageElements.length) {\r\n                        _.allFails();\r\n                    }\r\n                    else {\r\n                        _.notAllLoaded();\r\n                    }\r\n                }\r\n            }\r\n            else {\r\n                _.options.imageErrorAfterTimeout(element);\r\n            }\r\n        }\r\n\r\n        _.timeout = function(element) {\r\n            var key = Array.prototype.slice.call(_.imageElements).indexOf(element);\r\n\r\n            _.timeouts[key] = true;\r\n            _.timeoutImages++;\r\n\r\n            _.options.imageTimeout(element);\r\n\r\n            if (_.loadedImages + _.errorImages + _.timeoutImages === _.imageElements.length) {\r\n                if (_.errorImages === _.imageElements.length) {\r\n                    _.allFails();\r\n                }\r\n                else {\r\n                    _.notAllLoaded();\r\n                }\r\n            }\r\n        }\r\n\r\n\r\n\r\n        /*\r\n            Collection Events\r\n        */\r\n        _.allFails = function() {\r\n            console.log('all fails');\r\n        },\r\n\r\n        _.allLoaded = function() {\r\n            console.log('all loaded');\r\n        },\r\n\r\n        _.notAllLoaded = function() {\r\n            console.log('not all loaded, just ' + _.loadedImages + ' of ' + _.imageElements.length);\r\n        },\r\n\r\n\r\n\r\n        /*\r\n            Helper Functions\r\n        */\r\n        _.extend = function(destination, defaults, options) {\r\n            for (var property in defaults) {\r\n                if (options[property]) {\r\n                    destination[property] = options[property];\r\n                }\r\n                else {\r\n                    destination[property] = defaults[property];\r\n                }\r\n            }\r\n            return destination;\r\n        };\r\n\r\n        _.init();\r\n    }\r\n\r\n    return Imageloader;\r\n})();\r\n"],"file":"imageloader.js"}